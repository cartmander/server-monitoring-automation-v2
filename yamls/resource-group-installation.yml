parameters:
  - name: azureResourceManagerConnection
    type: string
    default: ICO-DEV-SERVICE-CONN

stages:
- stage: Build
  displayName: Install Agent by Resource Group
  jobs:
  - job: Build
    variables:
    - group: AGENT-INSTALLATION-RESOURCE-GROUP-VARS
    pool: IRRNDG-AUTOMATION-POOL
    steps:
      - task: AzureCLI@2
        displayName: 'Install Agent by Resource Group'
        inputs:
          azureSubscription: ${{ parameters.azureResourceManagerConnection }}
          scriptType: ps
          scriptPath: '$(System.DefaultWorkingDirectory)/scripts/InstallMMAByResourceGroup.ps1'
          arguments: '-subscription $(subscription) -resourceGroup $(resourceGroup) -workspaceId $(workspaceId) -workspaceKey $(workspaceKey)'